languages:
  - rust
patterns:
  - pattern: scope_cursor($<USER_INPUT>)
    filters:
      - variable: USER_INPUT
        detection: scope_test_user_input
        scope: cursor
  - pattern: scope_nested($<USER_INPUT>)
    filters:
      - variable: USER_INPUT
        detection: scope_test_user_input
        scope: nested
  - pattern: scope_result($<USER_INPUT>)
    filters:
      - variable: USER_INPUT
        detection: scope_test_user_input
        scope: result
auxiliary:
  - id: scope_test_user_input
    patterns:
      - pattern: $<REQUEST>.body()
        filters:
          - variable: REQUEST
            detection: scope_test_request_init
  - id: scope_test_request_init
    patterns:
      - pattern: |
          fn $<_>($<...>$<!>$<_>: Request$<...>)
      - pattern: |
          fn $<_>($<...>$<!>$<_>: &Request$<...>)
      - pattern: |
          let $<!>$<_>: Request
severity: high
metadata:
  description: Test detection filter scopes
  remediation_message: Test detection filter scopes
  cwe_id:
    - 42
  id: scope_test
